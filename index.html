<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Options Trading Journal</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
        }

        header {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 30px;
        }

        header h1 {
            color: #667eea;
            font-size: 2.5em;
            margin-bottom: 20px;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .tab {
            padding: 12px 24px;
            background: #f0f0f0;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            transition: all 0.3s;
        }

        .tab.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .stats-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            border-radius: 10px;
            color: white;
            text-align: center;
        }

        .stat-card.profit {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
        }

        .stat-card.loss {
            background: linear-gradient(135deg, #eb3349 0%, #f45c43 100%);
        }

        .stat-card.neutral {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        .stat-label {
            font-size: 0.85em;
            opacity: 0.9;
            margin-bottom: 5px;
        }

        .stat-value {
            font-size: 1.8em;
            font-weight: bold;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 30px;
        }

        @media (max-width: 1024px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }

        .form-section, .trades-section, .analytics-section {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.8em;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 15px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group.full-width {
            grid-column: 1 / -1;
        }

        .form-group label {
            color: #555;
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 0.9em;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1em;
            transition: all 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .btn-primary, .btn-secondary {
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
            margin-top: 10px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            width: 100%;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
            width: 100%;
            margin-left: 10px;
        }

        .btn-primary:hover, .btn-secondary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-group {
            display: flex;
            gap: 10px;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .filters select {
            padding: 10px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 0.9em;
            cursor: pointer;
        }

        .trade-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 15px;
            border-left: 4px solid #667eea;
            transition: transform 0.2s;
        }

        .trade-card:hover {
            transform: translateX(5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .trade-card.profit {
            border-left-color: #38ef7d;
            background: #f0fdf4;
        }

        .trade-card.loss {
            border-left-color: #f45c43;
            background: #fef2f2;
        }

        .trade-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .trade-symbol {
            font-size: 1.5em;
            font-weight: bold;
            color: #333;
        }

        .trade-badges {
            display: flex;
            gap: 10px;
        }

        .badge {
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
        }

        .badge.call {
            background: #d1fae5;
            color: #065f46;
        }

        .badge.put {
            background: #fee2e2;
            color: #991b1b;
        }

        .badge.buy {
            background: #dbeafe;
            color: #1e40af;
        }

        .badge.sell {
            background: #fef3c7;
            color: #92400e;
        }

        .trade-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }

        .detail-item {
            display: flex;
            flex-direction: column;
        }

        .detail-label {
            font-size: 0.85em;
            color: #666;
            margin-bottom: 3px;
        }

        .detail-value {
            font-size: 1.05em;
            font-weight: 600;
            color: #333;
        }

        .trade-pnl {
            font-size: 1.3em;
            font-weight: bold;
            text-align: center;
            padding: 10px;
            border-radius: 8px;
            margin-top: 10px;
        }

        .trade-pnl.profit {
            color: #065f46;
            background: #d1fae5;
        }

        .trade-pnl.loss {
            color: #991b1b;
            background: #fee2e2;
        }

        .trade-notes {
            margin-top: 15px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            font-size: 0.95em;
            color: #555;
            line-height: 1.6;
        }

        .btn-edit, .btn-delete {
            border: none;
            padding: 8px 15px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9em;
            margin-top: 10px;
            margin-right: 10px;
            transition: background 0.2s;
        }

        .btn-edit {
            background: #3b82f6;
            color: white;
        }

        .btn-edit:hover {
            background: #2563eb;
        }

        .btn-delete {
            background: #ef4444;
            color: white;
        }

        .btn-delete:hover {
            background: #dc2626;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #999;
        }

        .empty-state-icon {
            font-size: 4em;
            margin-bottom: 20px;
        }

        .analytics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .analytics-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            border-left: 4px solid #667eea;
        }

        .analytics-card h3 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 1.2em;
        }

        .analytics-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #e0e0e0;
        }

        .analytics-item:last-child {
            border-bottom: none;
        }

        .analytics-label {
            color: #666;
            font-size: 0.95em;
        }

        .analytics-value {
            font-weight: 600;
            color: #333;
        }

        .chart-container {
            margin-top: 20px;
            padding: 20px;
            background: white;
            border-radius: 10px;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ðŸ“Š Options Trading Journal</h1>
            <div class="tabs">
                <button class="tab active" onclick="switchTab('journal')">Journal</button>
                <button class="tab" onclick="switchTab('analytics')">Analytics</button>
            </div>
            <div class="stats-summary" id="statsSummary"></div>
        </header>

        <div id="journalTab" class="tab-content active">
            <div class="main-content">
                <div class="form-section">
                    <h2 id="formTitle">Add New Trade</h2>
                    <form id="tradeForm">
                        <input type="hidden" id="editTradeId">
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label>Date</label>
                                <input type="date" id="tradeDate" required>
                            </div>
                            <div class="form-group">
                                <label>Symbol</label>
                                <input type="text" id="symbol" placeholder="e.g., NIFTY, BANKNIFTY" required>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label>Option Type</label>
                                <select id="optionType" required>
                                    <option value="CALL">Call (CE)</option>
                                    <option value="PUT">Put (PE)</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Strike Price</label>
                                <input type="number" step="0.01" id="strikePrice" placeholder="19500" required>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label>Expiry Date</label>
                                <input type="date" id="expiryDate" required>
                            </div>
                            <div class="form-group">
                                <label>Action</label>
                                <select id="tradeAction" required>
                                    <option value="BUY">Buy</option>
                                    <option value="SELL">Sell</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label>Lots</label>
                                <input type="number" id="lots" placeholder="1" required>
                            </div>
                            <div class="form-group">
                                <label>Lot Size</label>
                                <input type="number" id="lotSize" placeholder="50" required>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label>Entry Premium (â‚¹)</label>
                                <input type="number" step="0.01" id="entryPremium" placeholder="150.50" required>
                            </div>
                            <div class="form-group">
                                <label>Exit Premium (â‚¹)</label>
                                <input type="number" step="0.01" id="exitPremium" placeholder="180.75">
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label>Stop Loss (â‚¹)</label>
                                <input type="number" step="0.01" id="stopLoss" placeholder="140.00">
                            </div>
                            <div class="form-group">
                                <label>Target (â‚¹)</label>
                                <input type="number" step="0.01" id="target" placeholder="200.00">
                            </div>
                        </div>

                        <div class="form-group full-width">
                            <label>Strategy</label>
                            <input type="text" id="strategy" placeholder="e.g., Straddle, Iron Condor, Directional">
                        </div>

                        <div class="form-group full-width">
                            <label>Notes</label>
                            <textarea id="notes" rows="3" placeholder="Market conditions, reasoning, emotions, learnings..."></textarea>
                        </div>

                        <div class="btn-group">
                            <button type="submit" class="btn-primary" id="submitBtn">Add Trade</button>
                            <button type="button" class="btn-secondary" id="cancelBtn" onclick="cancelEdit()" style="display:none;">Cancel</button>
                        </div>
                    </form>
                </div>

                <div class="trades-section">
                    <div class="section-header">
                        <h2>Trade History</h2>
                        <div class="filters">
                            <select id="filterType">
                                <option value="all">All Trades</option>
                                <option value="CALL">Calls Only</option>
                                <option value="PUT">Puts Only</option>
                                <option value="BUY">Buy Only</option>
                                <option value="SELL">Sell Only</option>
                                <option value="profit">Profitable</option>
                                <option value="loss">Loss</option>
                            </select>
                        </div>
                    </div>
                    <div id="tradesList"></div>
                </div>
            </div>
        </div>

        <div id="analyticsTab" class="tab-content">
            <div class="analytics-section">
                <h2>Performance Analytics</h2>
                <div id="analyticsContent"></div>
            </div>
        </div>
    </div>

    <script>
        let trades = [];
        let editingTradeId = null;

        function loadTrades() {
            const stored = localStorage.getItem('optionsJournal');
            if (stored) {
                trades = JSON.parse(stored);
            }
        }

        function saveTrades() {
            localStorage.setItem('optionsJournal', JSON.stringify(trades));
        }

        function calculatePnL(trade) {
            if (!trade.exitPremium) return 0;
            
            const quantity = trade.lots * trade.lotSize;
            const diff = trade.tradeAction === 'BUY' 
                ? (trade.exitPremium - trade.entryPremium) * quantity
                : (trade.entryPremium - trade.exitPremium) * quantity;
            
            return diff;
        }

        function updateStats() {
            const totalTrades = trades.length;
            const completedTrades = trades.filter(t => t.exitPremium);
            
            let totalPnL = 0;
            let winningTrades = 0;
            let losingTrades = 0;
            let totalPremiumPaid = 0;
            
            completedTrades.forEach(trade => {
                const pnl = calculatePnL(trade);
                totalPnL += pnl;
                if (pnl > 0) winningTrades++;
                else if (pnl < 0) losingTrades++;
            });

            trades.forEach(trade => {
                totalPremiumPaid += trade.entryPremium * trade.lots * trade.lotSize;
            });
            
            const winRate = completedTrades.length > 0 
                ? ((winningTrades / completedTrades.length) * 100).toFixed(1)
                : '0.0';

            const avgWin = winningTrades > 0 
                ? (completedTrades.filter(t => calculatePnL(t) > 0).reduce((sum, t) => sum + calculatePnL(t), 0) / winningTrades).toFixed(2)
                : '0.00';

            const avgLoss = losingTrades > 0 
                ? (completedTrades.filter(t => calculatePnL(t) < 0).reduce((sum, t) => sum + calculatePnL(t), 0) / losingTrades).toFixed(2)
                : '0.00';
            
            const statsHTML = `
                <div class="stat-card">
                    <div class="stat-label">Total Trades</div>
                    <div class="stat-value">${totalTrades}</div>
                </div>
                <div class="stat-card ${totalPnL >= 0 ? 'profit' : 'loss'}">
                    <div class="stat-label">Total P&L</div>
                    <div class="stat-value">â‚¹${totalPnL.toFixed(2)}</div>
                </div>
                <div class="stat-card profit">
                    <div class="stat-label">Winners</div>
                    <div class="stat-value">${winningTrades}</div>
                </div>
                <div class="stat-card loss">
                    <div class="stat-label">Losers</div>
                    <div class="stat-value">${losingTrades}</div>
                </div>
                <div class="stat-card neutral">
                    <div class="stat-label">Win Rate</div>
                    <div class="stat-value">${winRate}%</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Avg Win</div>
                    <div class="stat-value">â‚¹${avgWin}</div>
                </div>
            `;
            
            document.getElementById('statsSummary').innerHTML = statsHTML;
        }

        function renderTrades(filter = 'all') {
            let filteredTrades = [...trades];
            
            if (filter === 'CALL' || filter === 'PUT') {
                filteredTrades = trades.filter(t => t.optionType === filter);
            } else if (filter === 'BUY' || filter === 'SELL') {
                filteredTrades = trades.filter(t => t.tradeAction === filter);
            } else if (filter === 'profit') {
                filteredTrades = trades.filter(t => t.exitPremium && calculatePnL(t) > 0);
            } else if (filter === 'loss') {
                filteredTrades = trades.filter(t => t.exitPremium && calculatePnL(t) < 0);
            }
            
            const tradesList = document.getElementById('tradesList');
            
            if (filteredTrades.length === 0) {
                tradesList.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">ðŸ“ˆ</div>
                        <div class="empty-state-text">No trades yet. Start by adding your first options trade!</div>
                    </div>
                `;
                return;
            }
            
            filteredTrades.sort((a, b) => new Date(b.date).getTime() - new Date(a.date).getTime());
            
            tradesList.innerHTML = filteredTrades.map(trade => {
                const pnl = calculatePnL(trade);
                const pnlClass = pnl > 0 ? 'profit' : pnl < 0 ? 'loss' : '';
                const quantity = trade.lots * trade.lotSize;
                
                return `
                    <div class="trade-card ${pnlClass}">
                        <div class="trade-header">
                            <div class="trade-symbol">${trade.symbol} ${trade.strikePrice} ${trade.optionType}</div>
                            <div class="trade-badges">
                                <span class="badge ${trade.optionType.toLowerCase()}">${trade.optionType}</span>
                                <span class="badge ${trade.tradeAction.toLowerCase()}">${trade.tradeAction}</span>
                            </div>
                        </div>
                        
                        <div class="trade-details">
                            <div class="detail-item">
                                <span class="detail-label">Date</span>
                                <span class="detail-value">${new Date(trade.date).toLocaleDateString()}</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Expiry</span>
                                <span class="detail-value">${new Date(trade.expiryDate).toLocaleDateString()}</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Lots Ã— Size</span>
                                <span class="detail-value">${trade.lots} Ã— ${trade.lotSize}</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Quantity</span>
                                <span class="detail-value">${quantity}</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Entry Premium</span>
                                <span class="detail-value">â‚¹${trade.entryPremium.toFixed(2)}</span>
                            </div>
                            ${trade.exitPremium ? `
                                <div class="detail-item">
                                    <span class="detail-label">Exit Premium</span>
                                    <span class="detail-value">â‚¹${trade.exitPremium.toFixed(2)}</span>
                                </div>
                            ` : ''}
                            ${trade.stopLoss ? `
                                <div class="detail-item">
                                    <span class="detail-label">Stop Loss</span>
                                    <span class="detail-value">â‚¹${trade.stopLoss.toFixed(2)}</span>
                                </div>
                            ` : ''}
                            ${trade.target ? `
                                <div class="detail-item">
                                    <span class="detail-label">Target</span>
                                    <span class="detail-value">â‚¹${trade.target.toFixed(2)}</span>
                                </div>
                            ` : ''}
                            ${trade.strategy ? `
                                <div class="detail-item">
                                    <span class="detail-label">Strategy</span>
                                    <span class="detail-value">${trade.strategy}</span>
                                </div>
                            ` : ''}
                        </div>
                        
                        ${trade.exitPremium ? `
                            <div class="trade-pnl ${pnlClass}">
                                P&L: â‚¹${pnl.toFixed(2)} (${((pnl / (trade.entryPremium * quantity)) * 100).toFixed(2)}%)
                            </div>
                        ` : ''}
                        
                        ${trade.notes ? `
                            <div class="trade-notes">
                                <strong>Notes:</strong> ${trade.notes}
                            </div>
                        ` : ''}
                        
                        <div>
                            <button class="btn-edit" onclick="editTrade('${trade.id}')">Edit</button>
                            <button class="btn-delete" onclick="deleteTrade('${trade.id}')">Delete</button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function renderAnalytics() {
            const completedTrades = trades.filter(t => t.exitPremium);
            
            if (completedTrades.length === 0) {
                document.getElementById('analyticsContent').innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">ðŸ“Š</div>
                        <div class="empty-state-text">Complete some trades to see analytics!</div>
                    </div>
                `;
                return;
            }

            // Calculate analytics
            const callTrades = completedTrades.filter(t => t.optionType === 'CALL');
            const putTrades = completedTrades.filter(t => t.optionType === 'PUT');
            const buyTrades = completedTrades.filter(t => t.tradeAction === 'BUY');
            const sellTrades = completedTrades.filter(t => t.tradeAction === 'SELL');

            const callPnL = callTrades.reduce((sum, t) => sum + calculatePnL(t), 0);
            const putPnL = putTrades.reduce((sum, t) => sum + calculatePnL(t), 0);
            const buyPnL = buyTrades.reduce((sum, t) => sum + calculatePnL(t), 0);
            const sellPnL = sellTrades.reduce((sum, t) => sum + calculatePnL(t), 0);

            const callWinRate = callTrades.length > 0 
                ? ((callTrades.filter(t => calculatePnL(t) > 0).length / callTrades.length) * 100).toFixed(1)
                : '0.0';
            const putWinRate = putTrades.length > 0 
                ? ((putTrades.filter(t => calculatePnL(t) > 0).length / putTrades.length) * 100).toFixed(1)
                : '0.0';

            // Strategy breakdown
            const strategies = {};
            completedTrades.forEach(trade => {
                if (trade.strategy) {
                    if (!strategies[trade.strategy]) {
                        strategies[trade.strategy] = { count: 0, pnl: 0, wins: 0 };
                    }
                    strategies[trade.strategy].count++;
                    const pnl = calculatePnL(trade);
                    strategies[trade.strategy].pnl += pnl;
                    if (pnl > 0) strategies[trade.strategy].wins++;
                }
            });

            let strategyHTML = '';
            Object.keys(strategies).forEach(strategy => {
                const data = strategies[strategy];
                const winRate = ((data.wins / data.count) * 100).toFixed(1);
                strategyHTML += `
                    <div class="analytics-item">
                        <span class="analytics-label">${strategy}</span>
                        <span class="analytics-value">â‚¹${data.pnl.toFixed(2)} (${winRate}% WR)</span>
                    </div>
                `;
            });

            const analyticsHTML = `
                <div class="analytics-grid">
                    <div class="analytics-card">
                        <h3>Option Type Performance</h3>
                        <div class="analytics-item">
                            <span class="analytics-label">Call Trades</span>
                            <span class="analytics-value">${callTrades.length} trades</span>
                        </div>
                        <div class="analytics-item">
                            <span class="analytics-label">Call P&L</span>
                            <span class="analytics-value">â‚¹${callPnL.toFixed(2)}</span>
                        </div>
                        <div class="analytics-item">
                            <span class="analytics-label">Call Win Rate</span>
                            <span class="analytics-value">${callWinRate}%</span>
                        </div>
                        <div class="analytics-item">
                            <span class="analytics-label">Put Trades</span>
                            <span class="analytics-value">${putTrades.length} trades</span>
                        </div>
                        <div class="analytics-item">
                            <span class="analytics-label">Put P&L</span>
                            <span class="analytics-value">â‚¹${putPnL.toFixed(2)}</span>
                        </div>
                        <div class="analytics-item">
                            <span class="analytics-label">Put Win Rate</span>
                            <span class="analytics-value">${putWinRate}%</span>
                        </div>
                    </div>

                    <div class="analytics-card">
                        <h3>Action Performance</h3>
                        <div class="analytics-item">
                            <span class="analytics-label">Buy Trades</span>
                            <span class="analytics-value">${buyTrades.length} trades</span>
                        </div>
                        <div class="analytics-item">
                            <span class="analytics-label">Buy P&L</span>
                            <span class="analytics-value">â‚¹${buyPnL.toFixed(2)}</span>
                        </div>
                        <div class="analytics-item">
                            <span class="analytics-label">Sell Trades</span>
                            <span class="analytics-value">${sellTrades.length} trades</span>
                        </div>
                        <div class="analytics-item">
                            <span class="analytics-label">Sell P&L</span>
                            <span class="analytics-value">â‚¹${sellPnL.toFixed(2)}</span>
                        </div>
                    </div>

                    ${Object.keys(strategies).length > 0 ? `
                        <div class="analytics-card">
                            <h3>Strategy Performance</h3>
                            ${strategyHTML}
                        </div>
                    ` : ''}
                </div>
            `;

            document.getElementById('analyticsContent').innerHTML = analyticsHTML;
        }

        function addTrade(e) {
            e.preventDefault();
            
            const tradeId = document.getElementById('editTradeId').value;
            const trade = {
                id: tradeId || Date.now().toString(),
                date: document.getElementById('tradeDate').value,
                symbol: document.getElementById('symbol').value.toUpperCase(),
                optionType: document.getElementById('optionType').value,
                strikePrice: parseFloat(document.getElementById('strikePrice').value),
                expiryDate: document.getElementById('expiryDate').value,
                tradeAction: document.getElementById('tradeAction').value,
                lots: parseInt(document.getElementById('lots').value),
                lotSize: parseInt(document.getElementById('lotSize').value),
                entryPremium: parseFloat(document.getElementById('entryPremium').value),
                exitPremium: document.getElementById('exitPremium').value 
                    ? parseFloat(document.getElementById('exitPremium').value) 
                    : undefined,
                stopLoss: document.getElementById('stopLoss').value 
                    ? parseFloat(document.getElementById('stopLoss').value) 
                    : undefined,
                target: document.getElementById('target').value 
                    ? parseFloat(document.getElementById('target').value) 
                    : undefined,
                strategy: document.getElementById('strategy').value || undefined,
                notes: document.getElementById('notes').value || undefined
            };
            
            if (tradeId) {
                // Update existing trade
                const index = trades.findIndex(t => t.id === tradeId);
                if (index !== -1) {
                    trades[index] = trade;
                }
            } else {
                // Add new trade
                trades.push(trade);
            }
            
            saveTrades();
            updateStats();
            renderTrades();
            renderAnalytics();
            document.getElementById('tradeForm').reset();
            document.getElementById('editTradeId').value = '';
            document.getElementById('formTitle').textContent = 'Add New Trade';
            document.getElementById('submitBtn').textContent = 'Add Trade';
            document.getElementById('cancelBtn').style.display = 'none';
            document.getElementById('tradeDate').valueAsDate = new Date();
        }

        function editTrade(id) {
            const trade = trades.find(t => t.id === id);
            if (!trade) return;

            document.getElementById('editTradeId').value = trade.id;
            document.getElementById('tradeDate').value = trade.date;
            document.getElementById('symbol').value = trade.symbol;
            document.getElementById('optionType').value = trade.optionType;
            document.getElementById('strikePrice').value = trade.strikePrice;
            document.getElementById('expiryDate').value = trade.expiryDate;
            document.getElementById('tradeAction').value = trade.tradeAction;
            document.getElementById('lots').value = trade.lots;
            document.getElementById('lotSize').value = trade.lotSize;
            document.getElementById('entryPremium').value = trade.entryPremium;
            document.getElementById('exitPremium').value = trade.exitPremium || '';
            document.getElementById('stopLoss').value = trade.stopLoss || '';
            document.getElementById('target').value = trade.target || '';
            document.getElementById('strategy').value = trade.strategy || '';
            document.getElementById('notes').value = trade.notes || '';

            document.getElementById('formTitle').textContent = 'Edit Trade';
            document.getElementById('submitBtn').textContent = 'Update Trade';
            document.getElementById('cancelBtn').style.display = 'inline-block';

            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function cancelEdit() {
            document.getElementById('tradeForm').reset();
            document.getElementById('editTradeId').value = '';
            document.getElementById('formTitle').textContent = 'Add New Trade';
            document.getElementById('submitBtn').textContent = 'Add Trade';
            document.getElementById('cancelBtn').style.display = 'none';
            document.getElementById('tradeDate').valueAsDate = new Date();
        }

        function deleteTrade(id) {
            if (confirm('Are you sure you want to delete this trade?')) {
                trades = trades.filter(t => t.id !== id);
                saveTrades();
                updateStats();
                renderTrades();
                renderAnalytics();
            }
        }

        function switchTab(tab) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            
            if (tab === 'journal') {
                document.querySelector('.tab:nth-child(1)').classList.add('active');
                document.getElementById('journalTab').classList.add('active');
            } else if (tab === 'analytics') {
                document.querySelector('.tab:nth-child(2)').classList.add('active');
                document.getElementById('analyticsTab').classList.add('active');
                renderAnalytics();
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            loadTrades();
            updateStats();
            renderTrades();
            document.getElementById('tradeDate').valueAsDate = new Date();
            document.getElementById('tradeForm').addEventListener('submit', addTrade);
            document.getElementById('filterType').addEventListener('change', (e) => {
                renderTrades(e.target.value);
            });
        });
    </script>
</body>
</html>