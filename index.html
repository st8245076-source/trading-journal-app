<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trading Journal - Multi-Market</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
        }

        header {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 30px;
        }

        header h1 {
            color: #667eea;
            font-size: 2.5em;
            margin-bottom: 20px;
        }

        .market-selector {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .market-btn {
            padding: 15px 30px;
            background: #f0f0f0;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: 600;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .market-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: #667eea;
        }

        .market-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .tab {
            padding: 12px 24px;
            background: #f0f0f0;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            transition: all 0.3s;
        }

        .tab.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .stats-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            border-radius: 10px;
            color: white;
            text-align: center;
        }

        .stat-card.profit {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
        }

        .stat-card.loss {
            background: linear-gradient(135deg, #eb3349 0%, #f45c43 100%);
        }

        .stat-card.neutral {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        .stat-label {
            font-size: 0.85em;
            opacity: 0.9;
            margin-bottom: 5px;
        }

        .stat-value {
            font-size: 1.8em;
            font-weight: bold;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 30px;
        }

        @media (max-width: 1024px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }

        .form-section, .trades-section, .analytics-section {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.8em;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 15px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group.full-width {
            grid-column: 1 / -1;
        }

        .form-group label {
            color: #555;
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 0.9em;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1em;
            transition: all 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .btn-primary, .btn-secondary {
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
            margin-top: 10px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            width: 100%;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
            width: 100%;
            margin-left: 10px;
        }

        .btn-primary:hover, .btn-secondary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-group {
            display: flex;
            gap: 10px;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .filters select {
            padding: 10px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 0.9em;
            cursor: pointer;
        }

        .trade-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 15px;
            border-left: 4px solid #667eea;
            transition: transform 0.2s;
        }

        .trade-card:hover {
            transform: translateX(5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .trade-card.profit {
            border-left-color: #38ef7d;
            background: #f0fdf4;
        }

        .trade-card.loss {
            border-left-color: #f45c43;
            background: #fef2f2;
        }

        .trade-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .trade-symbol {
            font-size: 1.5em;
            font-weight: bold;
            color: #333;
        }

        .trade-badges {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .badge {
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
        }

        .badge.call {
            background: #d1fae5;
            color: #065f46;
        }

        .badge.put {
            background: #fee2e2;
            color: #991b1b;
        }

        .badge.buy, .badge.long {
            background: #dbeafe;
            color: #1e40af;
        }

        .badge.sell, .badge.short {
            background: #fef3c7;
            color: #92400e;
        }

        .badge.options {
            background: #e0e7ff;
            color: #3730a3;
        }

        .badge.crypto {
            background: #fef3c7;
            color: #92400e;
        }

        .badge.forex {
            background: #dbeafe;
            color: #1e40af;
        }

        .trade-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }

        .detail-item {
            display: flex;
            flex-direction: column;
        }

        .detail-label {
            font-size: 0.85em;
            color: #666;
            margin-bottom: 3px;
        }

        .detail-value {
            font-size: 1.05em;
            font-weight: 600;
            color: #333;
        }

        .trade-pnl {
            font-size: 1.3em;
            font-weight: bold;
            text-align: center;
            padding: 10px;
            border-radius: 8px;
            margin-top: 10px;
        }

        .trade-pnl.profit {
            color: #065f46;
            background: #d1fae5;
        }

        .trade-pnl.loss {
            color: #991b1b;
            background: #fee2e2;
        }

        .trade-notes {
            margin-top: 15px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            font-size: 0.95em;
            color: #555;
            line-height: 1.6;
        }

        .btn-edit, .btn-delete {
            border: none;
            padding: 8px 15px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9em;
            margin-top: 10px;
            margin-right: 10px;
            transition: background 0.2s;
        }

        .btn-edit {
            background: #3b82f6;
            color: white;
        }

        .btn-edit:hover {
            background: #2563eb;
        }

        .btn-delete {
            background: #ef4444;
            color: white;
        }

        .btn-delete:hover {
            background: #dc2626;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #999;
        }

        .empty-state-icon {
            font-size: 4em;
            margin-bottom: 20px;
        }

        .analytics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .analytics-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            border-left: 4px solid #667eea;
        }

        .analytics-card h3 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 1.2em;
        }

        .analytics-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #e0e0e0;
        }

        .analytics-item:last-child {
            border-bottom: none;
        }

        .analytics-label {
            color: #666;
            font-size: 0.95em;
        }

        .analytics-value {
            font-weight: 600;
            color: #333;
        }

        .hidden {
            display: none !important;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ðŸ“Š Multi-Market Trading Journal</h1>
            
            <div class="market-selector">
                <button class="market-btn active" onclick="switchMarket('options')">
                    ðŸ“ˆ Options
                </button>
                <button class="market-btn" onclick="switchMarket('crypto')">
                    â‚¿ Crypto
                </button>
                <button class="market-btn" onclick="switchMarket('forex')">
                    ðŸ’± Forex
                </button>
            </div>

            <div class="tabs">
                <button class="tab active" onclick="switchTab('journal')">Journal</button>
                <button class="tab" onclick="switchTab('analytics')">Analytics</button>
            </div>
            <div class="stats-summary" id="statsSummary"></div>
        </header>

        <div id="journalTab" class="tab-content active">
            <div class="main-content">
                <div class="form-section">
                    <h2 id="formTitle">Add New Trade</h2>
                    <form id="tradeForm">
                        <input type="hidden" id="editTradeId">
                        <input type="hidden" id="marketType" value="options">
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label>Date</label>
                                <input type="date" id="tradeDate" required>
                            </div>
                            <div class="form-group">
                                <label id="symbolLabel">Symbol</label>
                                <select id="symbol" required>
                                    <!-- Options will be populated based on market -->
                                </select>
                            </div>
                        </div>

                        <!-- Options-specific fields -->
                        <div id="optionsFields">
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Option Type</label>
                                    <select id="optionType">
                                        <option value="CALL">Call (CE)</option>
                                        <option value="PUT">Put (PE)</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Strike Price</label>
                                    <input type="number" step="0.01" id="strikePrice" placeholder="19500">
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label>Expiry Date</label>
                                    <input type="date" id="expiryDate">
                                </div>
                                <div class="form-group">
                                    <label>Action</label>
                                    <select id="optionAction">
                                        <option value="BUY">Buy</option>
                                        <option value="SELL">Sell</option>
                                    </select>
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label>Lots</label>
                                    <input type="number" id="lots" placeholder="1">
                                </div>
                                <div class="form-group">
                                    <label>Lot Size</label>
                                    <input type="number" id="lotSize" placeholder="50">
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label>Entry Premium (â‚¹)</label>
                                    <input type="number" step="0.01" id="entryPremium" placeholder="150.50">
                                </div>
                                <div class="form-group">
                                    <label>Exit Premium (â‚¹)</label>
                                    <input type="number" step="0.01" id="exitPremium" placeholder="180.75">
                                </div>
                            </div>
                        </div>

                        <!-- Crypto/Forex fields -->
                        <div id="spotFields" class="hidden">
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Position</label>
                                    <select id="position">
                                        <option value="LONG">Long (Buy)</option>
                                        <option value="SHORT">Short (Sell)</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label id="quantityLabel">Quantity</label>
                                    <input type="number" step="0.00000001" id="quantity" placeholder="0.5">
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label id="entryPriceLabel">Entry Price</label>
                                    <input type="number" step="0.01" id="entryPrice" placeholder="50000">
                                </div>
                                <div class="form-group">
                                    <label id="exitPriceLabel">Exit Price</label>
                                    <input type="number" step="0.01" id="exitPrice" placeholder="52000">
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label>Leverage</label>
                                    <input type="number" step="1" id="leverage" placeholder="1" value="1">
                                </div>
                                <div class="form-group">
                                    <label>Fees ($)</label>
                                    <input type="number" step="0.01" id="fees" placeholder="10.50">
                                </div>
                            </div>
                        </div>

                        <!-- Common fields -->
                        <div class="form-row">
                            <div class="form-group">
                                <label id="stopLossLabel">Stop Loss</label>
                                <input type="number" step="0.01" id="stopLoss" placeholder="140.00">
                            </div>
                            <div class="form-group">
                                <label id="targetLabel">Target</label>
                                <input type="number" step="0.01" id="target" placeholder="200.00">
                            </div>
                        </div>

                        <div class="form-group full-width">
                            <label>Strategy</label>
                            <input type="text" id="strategy" placeholder="e.g., Breakout, Trend Following">
                        </div>

                        <div class="form-group full-width">
                            <label>Notes</label>
                            <textarea id="notes" rows="3" placeholder="Market conditions, reasoning, emotions, learnings..."></textarea>
                        </div>

                        <div class="btn-group">
                            <button type="submit" class="btn-primary" id="submitBtn">Add Trade</button>
                            <button type="button" class="btn-secondary" id="cancelBtn" onclick="cancelEdit()" style="display:none;">Cancel</button>
                        </div>
                    </form>
                </div>

                <div class="trades-section">
                    <div class="section-header">
                        <h2>Trade History</h2>
                        <div class="filters">
                            <select id="filterType">
                                <option value="all">All Trades</option>
                            </select>
                        </div>
                    </div>
                    <div id="tradesList"></div>
                </div>
            </div>
        </div>

        <div id="analyticsTab" class="tab-content">
            <div class="analytics-section">
                <h2>Performance Analytics</h2>
                <div id="analyticsContent"></div>
            </div>
        </div>
    </div>

    <script>
        let trades = [];
        let currentMarket = 'options';

        const marketSymbols = {
            options: ['NIFTY', 'BANKNIFTY', 'FINNIFTY', 'MIDCPNIFTY', 'SENSEX', 'BANKEX'],
            crypto: ['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'XRP/USDT', 'ADA/USDT', 'DOGE/USDT', 'MATIC/USDT'],
            forex: ['EUR/USD', 'GBP/USD', 'USD/JPY', 'AUD/USD', 'USD/CAD', 'NZD/USD', 'US30', 'GER30', 'NDX100', 'XAU/USD']
        };

        function loadTrades() {
            const stored = localStorage.getItem('multiMarketJournal');
            if (stored) {
                trades = JSON.parse(stored);
            }
        }

        function saveTrades() {
            localStorage.setItem('multiMarketJournal', JSON.stringify(trades));
        }

        function switchMarket(market) {
            currentMarket = market;
            
            document.querySelectorAll('.market-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');

            populateSymbols();
            updateFormFields();
            updateStats();
            renderTrades();
        }

        function populateSymbols() {
            const symbolSelect = document.getElementById('symbol');
            symbolSelect.innerHTML = '';
            
            marketSymbols[currentMarket].forEach(symbol => {
                const option = document.createElement('option');
                option.value = symbol;
                option.textContent = symbol;
                symbolSelect.appendChild(option);
            });
        }

        function updateFormFields() {
            const optionsFields = document.getElementById('optionsFields');
            const spotFields = document.getElementById('spotFields');
            const filterType = document.getElementById('filterType');

            if (currentMarket === 'options') {
                optionsFields.classList.remove('hidden');
                spotFields.classList.add('hidden');
                document.getElementById('symbolLabel').textContent = 'Index';
                
                filterType.innerHTML = `
                    <option value="all">All Trades</option>
                    <option value="CALL">Calls Only</option>
                    <option value="PUT">Puts Only</option>
                    <option value="BUY">Buy Only</option>
                    <option value="SELL">Sell Only</option>
                    <option value="profit">Profitable</option>
                    <option value="loss">Loss</option>
                `;
            } else {
                optionsFields.classList.add('hidden');
                spotFields.classList.remove('hidden');
                document.getElementById('symbolLabel').textContent = 'Pair';
                
                if (currentMarket === 'crypto') {
                    document.getElementById('quantityLabel').textContent = 'Quantity (Coins)';
                    document.getElementById('entryPriceLabel').textContent = 'Entry Price ($)';
                    document.getElementById('exitPriceLabel').textContent = 'Exit Price ($)';
                    document.getElementById('stopLossLabel').textContent = 'Stop Loss ($)';
                    document.getElementById('targetLabel').textContent = 'Target ($)';
                } else {
                    document.getElementById('quantityLabel').textContent = 'Lot Size';
                    document.getElementById('entryPriceLabel').textContent = 'Entry Price';
                    document.getElementById('exitPriceLabel').textContent = 'Exit Price';
                    document.getElementById('stopLossLabel').textContent = 'Stop Loss';
                    document.getElementById('targetLabel').textContent = 'Target';
                }

                filterType.innerHTML = `
                    <option value="all">All Trades</option>
                    <option value="LONG">Long Only</option>
                    <option value="SHORT">Short Only</option>
                    <option value="profit">Profitable</option>
                    <option value="loss">Loss</option>
                `;
            }
        }

        function calculatePnL(trade) {
            if (trade.marketType === 'options') {
                if (!trade.exitPremium) return 0;
                const quantity = trade.lots * trade.lotSize;
                const diff = trade.optionAction === 'BUY' 
                    ? (trade.exitPremium - trade.entryPremium) * quantity
                    : (trade.entryPremium - trade.exitPremium) * quantity;
                return diff;
            } else {
                if (!trade.exitPrice) return 0;
                const diff = trade.position === 'LONG'
                    ? (trade.exitPrice - trade.entryPrice) * trade.quantity * (trade.leverage || 1)
                    : (trade.entryPrice - trade.exitPrice) * trade.quantity * (trade.leverage || 1);
                return diff - (trade.fees || 0);
            }
        }

        function updateStats() {
            const marketTrades = trades.filter(t => t.marketType === currentMarket);
            const totalTrades = marketTrades.length;
            const completedTrades = marketTrades.filter(t => 
                currentMarket === 'options' ? t.exitPremium : t.exitPrice
            );
            
            let totalPnL = 0;
            let winningTrades = 0;
            let losingTrades = 0;
            
            completedTrades.forEach(trade => {
                const pnl = calculatePnL(trade);
                totalPnL += pnl;
                if (pnl > 0) winningTrades++;
                else if (pnl < 0) losingTrades++;
            });
            
            const winRate = completedTrades.length > 0 
                ? ((winningTrades / completedTrades.length) * 100).toFixed(1)
                : '0.0';

            const avgWin = winningTrades > 0 
                ? (completedTrades.filter(t => calculatePnL(t) > 0).reduce((sum, t) => sum + calculatePnL(t), 0) / winningTrades).toFixed(2)
                : '0.00';

            const currency = currentMarket === 'options' ? 'â‚¹' : '$';
            
            const statsHTML = `
                <div class="stat-card">
                    <div class="stat-label">Total Trades</div>
                    <div class="stat-value">${totalTrades}</div>
                </div>
                <div class="stat-card ${totalPnL >= 0 ? 'profit' : 'loss'}">
                    <div class="stat-label">Total P&L</div>
                    <div class="stat-value">${currency}${totalPnL.toFixed(2)}</div>
                </div>
                <div class="stat-card profit">
                    <div class="stat-label">Winners</div>
                    <div class="stat-value">${winningTrades}</div>
                </div>
                <div class="stat-card loss">
                    <div class="stat-label">Losers</div>
                    <div class="stat-value">${losingTrades}</div>
                </div>
                <div class="stat-card neutral">
                    <div class="stat-label">Win Rate</div>
                    <div class="stat-value">${winRate}%</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Avg Win</div>
                    <div class="stat-value">${currency}${avgWin}</div>
                </div>
            `;
            
            document.getElementById('statsSummary').innerHTML = statsHTML;
        }

        function renderTrades(filter = 'all') {
            let filteredTrades = trades.filter(t => t.marketType === currentMarket);
            
            if (currentMarket === 'options') {
                if (filter === 'CALL' || filter === 'PUT') {
                    filteredTrades = filteredTrades.filter(t => t.optionType === filter);
                } else if (filter === 'BUY' || filter === 'SELL') {
                    filteredTrades = filteredTrades.filter(t => t.optionAction === filter);
                } else if (filter === 'profit') {
                    filteredTrades = filteredTrades.filter(t => t.exitPremium && calculatePnL(t) > 0);
                } else if (filter === 'loss') {
                    filteredTrades = filteredTrades.filter(t => t.exitPremium && calculatePnL(t) < 0);
                }
            } else {
                if (filter === 'LONG' || filter === 'SHORT') {
                    filteredTrades = filteredTrades.filter(t => t.position === filter);
                } else if (filter === 'profit') {
                    filteredTrades = filteredTrades.filter(t => t.exitPrice && calculatePnL(t) > 0);
                } else if (filter === 'loss') {
                    filteredTrades = filteredTrades.filter(t => t.exitPrice && calculatePnL(t) < 0);
                }
            }
            
            const tradesList = document.getElementById('tradesList');
            
            if (filteredTrades.length === 0) {
                tradesList.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">ðŸ“ˆ</div>
                        <div class="empty-state-text">No ${currentMarket} trades yet. Start by adding your first trade!</div>
                    </div>
                `;
                return;
            }
            
            filteredTrades.sort((a, b) => new Date(b.date).getTime() - new Date(a.date).getTime());
            
            tradesList.innerHTML = filteredTrades.map(trade => {
                const pnl = calculatePnL(trade);
                const pnlClass = pnl > 0 ? 'profit' : pnl < 0 ? 'loss' : '';
                const currency = trade.marketType === 'options' ? 'â‚¹' : '$';
                
                if (trade.marketType === 'options') {
                    const quantity = trade.lots * trade.lotSize;
                    return `
                        <div class="trade-card ${pnlClass}">
                            <div class="trade-header">
                                <div class="trade-symbol">${trade.symbol} ${trade.strikePrice} ${trade.optionType}</div>
                                <div class="trade-badges">
                                    <span class="badge options">OPTIONS</span>
                                    <span class="badge ${trade.optionType.toLowerCase()}">${trade.optionType}</span>
                                    <span class="badge ${trade.optionAction.toLowerCase()}">${trade.optionAction}</span>
                                </div>
                            </div>
                            
                            <div class="trade-details">
                                <div class="detail-item">
                                    <span class="detail-label">Date</span>
                                    <span class="detail-value">${new Date(trade.date).toLocaleDateString()}</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">Expiry</span>
                                    <span class="detail-value">${new Date(trade.expiryDate).toLocaleDateString()}</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">Lots Ã— Size</span>
                                    <span class="detail-value">${trade.lots} Ã— ${trade.lotSize}</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">Entry Premium</span>
                                    <span class="detail-value">${currency}${trade.entryPremium.toFixed(2)}</span>
                                </div>
                                ${trade.exitPremium ? `
                                    <div class="detail-item">
                                        <span class="detail-label">Exit Premium</span>
                                        <span class="detail-value">${currency}${trade.exitPremium.toFixed(2)}</span>
                                    </div>
                                ` : ''}
                                ${trade.strategy ? `
                                    <div class="detail-item">
                                        <span class="detail-label">Strategy</span>
                                        <span class="detail-value">${trade.strategy}</span>
                                    </div>
                                ` : ''}
                            </div>
                            
                            ${trade.exitPremium ? `
                                <div class="trade-pnl ${pnlClass}">
                                    P&L: ${currency}${pnl.toFixed(2)} (${((pnl / (trade.entryPremium * quantity)) * 100).toFixed(2)}%)
                                </div>
                            ` : ''}
                            
                            ${trade.notes ? `
                                <div class="trade-notes">
                                    <strong>Notes:</strong> ${trade.notes}
                                </div>
                            ` : ''}
                            
                            <div>
                                <button class="btn-edit" onclick="editTrade('${trade.id}')">Edit</button>
                                <button class="btn-delete" onclick="deleteTrade('${trade.id}')">Delete</button>
                            </div>
                        </div>
                    `;
                } else {
                    return `
                        <div class="trade-card ${pnlClass}">
                            <div class="trade-header">
                                <div class="trade-symbol">${trade.symbol}</div>
                                <div class="trade-badges">
                                    <span class="badge ${trade.marketType}">${trade.marketType.toUpperCase()}</span>
                                    <span class="badge ${trade.position.toLowerCase()}">${trade.position}</span>
                                </div>
                            </div>
                            
                            <div class="trade-details">
                                <div class="detail-item">
                                    <span class="detail-label">Date</span>
                                    <span class="detail-value">${new Date(trade.date).toLocaleDateString()}</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">Quantity</span>
                                    <span class="detail-value">${trade.quantity}</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">Entry Price</span>
                                    <span class="detail-value">${currency}${trade.entryPrice.toFixed(2)}</span>
                                </div>
                                ${trade.exitPrice ? `
                                    <div class="detail-item">
                                        <span class="detail-label">Exit Price</span>
                                        <span class="detail-value">${currency}${trade.exitPrice.toFixed(2)}</span>
                                    </div>
                                ` : ''}
                                ${trade.leverage && trade.leverage > 1 ? `
                                    <div class="detail-item">
                                        <span class="detail-label">Leverage</span>
                                        <span class="detail-value">${trade.leverage}x</span>
                                    </div>
                                ` : ''}
                                ${trade.strategy ? `
                                    <div class="detail-item">
                                        <span class="detail-label">Strategy</span>
                                        <span class="detail-value">${trade.strategy}</span>
                                    </div>
                                ` : ''}
                            </div>
                            
                            ${trade.exitPrice ? `
                                <div class="trade-pnl ${pnlClass}">
                                    P&L: ${currency}${pnl.toFixed(2)} (${((pnl / (trade.entryPrice * trade.quantity)) * 100).toFixed(2)}%)
                                </div>
                            ` : ''}
                            
                            ${trade.notes ? `
                                <div class="trade-notes">
                                    <strong>Notes:</strong> ${trade.notes}
                                </div>
                            ` : ''}
                            
                            <div>
                                <button class="btn-edit" onclick="editTrade('${trade.id}')">Edit</button>
                                <button class="btn-delete" onclick="deleteTrade('${trade.id}')">Delete</button>
                            </div>
                        </div>
                    `;
                }
            }).join('');
        }

        function renderAnalytics() {
            const marketTrades = trades.filter(t => t.marketType === currentMarket);
            const completedTrades = marketTrades.filter(t => 
                currentMarket === 'options' ? t.exitPremium : t.exitPrice
            );
            
            if (completedTrades.length === 0) {
                document.getElementById('analyticsContent').innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">ðŸ“Š</div>
                        <div class="empty-state-text">Complete some ${currentMarket} trades to see analytics!</div>
                    </div>
                `;
                return;
            }

            const currency = currentMarket === 'options' ? 'â‚¹' : '$';
            let analyticsHTML = '<div class="analytics-grid">';

            if (currentMarket === 'options') {
                const callTrades = completedTrades.filter(t => t.optionType === 'CALL');
                const putTrades = completedTrades.filter(t => t.optionType === 'PUT');
                const callPnL = callTrades.reduce((sum, t) => sum + calculatePnL(t), 0);
                const putPnL = putTrades.reduce((sum, t) => sum + calculatePnL(t), 0);
                const callWinRate = callTrades.length > 0 
                    ? ((callTrades.filter(t => calculatePnL(t) > 0).length / callTrades.length) * 100).toFixed(1)
                    : '0.0';
                const putWinRate = putTrades.length > 0 
                    ? ((putTrades.filter(t => calculatePnL(t) > 0).length / putTrades.length) * 100).toFixed(1)
                    : '0.0';

                analyticsHTML += `
                    <div class="analytics-card">
                        <h3>Option Type Performance</h3>
                        <div class="analytics-item">
                            <span class="analytics-label">Call Trades</span>
                            <span class="analytics-value">${callTrades.length} trades</span>
                        </div>
                        <div class="analytics-item">
                            <span class="analytics-label">Call P&L</span>
                            <span class="analytics-value">${currency}${callPnL.toFixed(2)}</span>
                        </div>
                        <div class="analytics-item">
                            <span class="analytics-label">Call Win Rate</span>
                            <span class="analytics-value">${callWinRate}%</span>
                        </div>
                        <div class="analytics-item">
                            <span class="analytics-label">Put Trades</span>
                            <span class="analytics-value">${putTrades.length} trades</span>
                        </div>
                        <div class="analytics-item">
                            <span class="analytics-label">Put P&L</span>
                            <span class="analytics-value">${currency}${putPnL.toFixed(2)}</span>
                        </div>
                        <div class="analytics-item">
                            <span class="analytics-label">Put Win Rate</span>
                            <span class="analytics-value">${putWinRate}%</span>
                        </div>
                    </div>
                `;
            } else {
                const longTrades = completedTrades.filter(t => t.position === 'LONG');
                const shortTrades = completedTrades.filter(t => t.position === 'SHORT');
                const longPnL = longTrades.reduce((sum, t) => sum + calculatePnL(t), 0);
                const shortPnL = shortTrades.reduce((sum, t) => sum + calculatePnL(t), 0);

                analyticsHTML += `
                    <div class="analytics-card">
                        <h3>Position Performance</h3>
                        <div class="analytics-item">
                            <span class="analytics-label">Long Trades</span>
                            <span class="analytics-value">${longTrades.length} trades</span>
                        </div>
                        <div class="analytics-item">
                            <span class="analytics-label">Long P&L</span>
                            <span class="analytics-value">${currency}${longPnL.toFixed(2)}</span>
                        </div>
                        <div class="analytics-item">
                            <span class="analytics-label">Short Trades</span>
                            <span class="analytics-value">${shortTrades.length} trades</span>
                        </div>
                        <div class="analytics-item">
                            <span class="analytics-label">Short P&L</span>
                            <span class="analytics-value">${currency}${shortPnL.toFixed(2)}</span>
                        </div>
                    </div>
                `;
            }

            // Symbol breakdown
            const symbols = {};
            completedTrades.forEach(trade => {
                if (!symbols[trade.symbol]) {
                    symbols[trade.symbol] = { count: 0, pnl: 0, wins: 0 };
                }
                symbols[trade.symbol].count++;
                const pnl = calculatePnL(trade);
                symbols[trade.symbol].pnl += pnl;
                if (pnl > 0) symbols[trade.symbol].wins++;
            });

            let symbolHTML = '';
            Object.keys(symbols).forEach(symbol => {
                const data = symbols[symbol];
                const winRate = ((data.wins / data.count) * 100).toFixed(1);
                symbolHTML += `
                    <div class="analytics-item">
                        <span class="analytics-label">${symbol}</span>
                        <span class="analytics-value">${currency}${data.pnl.toFixed(2)} (${winRate}% WR)</span>
                    </div>
                `;
            });

            analyticsHTML += `
                <div class="analytics-card">
                    <h3>Symbol Performance</h3>
                    ${symbolHTML}
                </div>
            `;

            analyticsHTML += '</div>';
            document.getElementById('analyticsContent').innerHTML = analyticsHTML;
        }

        function addTrade(e) {
            e.preventDefault();
            
            const tradeId = document.getElementById('editTradeId').value;
            const baseData = {
                id: tradeId || Date.now().toString(),
                date: document.getElementById('tradeDate').value,
                symbol: document.getElementById('symbol').value,
                marketType: currentMarket,
                stopLoss: document.getElementById('stopLoss').value 
                    ? parseFloat(document.getElementById('stopLoss').value) 
                    : undefined,
                target: document.getElementById('target').value 
                    ? parseFloat(document.getElementById('target').value) 
                    : undefined,
                strategy: document.getElementById('strategy').value || undefined,
                notes: document.getElementById('notes').value || undefined
            };

            let trade;
            if (currentMarket === 'options') {
                trade = {
                    ...baseData,
                    optionType: document.getElementById('optionType').value,
                    strikePrice: parseFloat(document.getElementById('strikePrice').value),
                    expiryDate: document.getElementById('expiryDate').value,
                    optionAction: document.getElementById('optionAction').value,
                    lots: parseInt(document.getElementById('lots').value),
                    lotSize: parseInt(document.getElementById('lotSize').value),
                    entryPremium: parseFloat(document.getElementById('entryPremium').value),
                    exitPremium: document.getElementById('exitPremium').value 
                        ? parseFloat(document.getElementById('exitPremium').value) 
                        : undefined
                };
            } else {
                trade = {
                    ...baseData,
                    position: document.getElementById('position').value,
                    quantity: parseFloat(document.getElementById('quantity').value),
                    entryPrice: parseFloat(document.getElementById('entryPrice').value),
                    exitPrice: document.getElementById('exitPrice').value 
                        ? parseFloat(document.getElementById('exitPrice').value) 
                        : undefined,
                    leverage: document.getElementById('leverage').value 
                        ? parseInt(document.getElementById('leverage').value) 
                        : 1,
                    fees: document.getElementById('fees').value 
                        ? parseFloat(document.getElementById('fees').value) 
                        : 0
                };
            }
            
            if (tradeId) {
                const index = trades.findIndex(t => t.id === tradeId);
                if (index !== -1) {
                    trades[index] = trade;
                }
            } else {
                trades.push(trade);
            }
            
            saveTrades();
            updateStats();
            renderTrades();
            renderAnalytics();
            document.getElementById('tradeForm').reset();
            document.getElementById('editTradeId').value = '';
            document.getElementById('formTitle').textContent = 'Add New Trade';
            document.getElementById('submitBtn').textContent = 'Add Trade';
            document.getElementById('cancelBtn').style.display = 'none';
            document.getElementById('tradeDate').valueAsDate = new Date();
        }

        function editTrade(id) {
            const trade = trades.find(t => t.id === id);
            if (!trade) return;

            if (trade.marketType !== currentMarket) {
                switchMarket(trade.marketType);
                document.querySelectorAll('.market-btn').forEach((btn, idx) => {
                    btn.classList.remove('active');
                    if ((idx === 0 && trade.marketType === 'options') ||
                        (idx === 1 && trade.marketType === 'crypto') ||
                        (idx === 2 && trade.marketType === 'forex')) {
                        btn.classList.add('active');
                    }
                });
            }

            document.getElementById('editTradeId').value = trade.id;
            document.getElementById('tradeDate').value = trade.date;
            document.getElementById('symbol').value = trade.symbol;
            document.getElementById('stopLoss').value = trade.stopLoss || '';
            document.getElementById('target').value = trade.target || '';
            document.getElementById('strategy').value = trade.strategy || '';
            document.getElementById('notes').value = trade.notes || '';

            if (trade.marketType === 'options') {
                document.getElementById('optionType').value = trade.optionType;
                document.getElementById('strikePrice').value = trade.strikePrice;
                document.getElementById('expiryDate').value = trade.expiryDate;
                document.getElementById('optionAction').value = trade.optionAction;
                document.getElementById('lots').value = trade.lots;
                document.getElementById('lotSize').value = trade.lotSize;
                document.getElementById('entryPremium').value = trade.entryPremium;
                document.getElementById('exitPremium').value = trade.exitPremium || '';
            } else {
                document.getElementById('position').value = trade.position;
                document.getElementById('quantity').value = trade.quantity;
                document.getElementById('entryPrice').value = trade.entryPrice;
                document.getElementById('exitPrice').value = trade.exitPrice || '';
                document.getElementById('leverage').value = trade.leverage || 1;
                document.getElementById('fees').value = trade.fees || 0;
            }

            document.getElementById('formTitle').textContent = 'Edit Trade';
            document.getElementById('submitBtn').textContent = 'Update Trade';
            document.getElementById('cancelBtn').style.display = 'inline-block';

            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function cancelEdit() {
            document.getElementById('tradeForm').reset();
            document.getElementById('editTradeId').value = '';
            document.getElementById('formTitle').textContent = 'Add New Trade';
            document.getElementById('submitBtn').textContent = 'Add Trade';
            document.getElementById('cancelBtn').style.display = 'none';
            document.getElementById('tradeDate').valueAsDate = new Date();
        }

        function deleteTrade(id) {
            if (confirm('Are you sure you want to delete this trade?')) {
                trades = trades.filter(t => t.id !== id);
                saveTrades();
                updateStats();
                renderTrades();
                renderAnalytics();
            }
        }

        function switchTab(tab) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            
            if (tab === 'journal') {
                document.querySelector('.tab:nth-child(1)').classList.add('active');
                document.getElementById('journalTab').classList.add('active');
            } else if (tab === 'analytics') {
                document.querySelector('.tab:nth-child(2)').classList.add('active');
                document.getElementById('analyticsTab').classList.add('active');
                renderAnalytics();
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            loadTrades();
            populateSymbols();
            updateFormFields();
            updateStats();
            renderTrades();
            document.getElementById('tradeDate').valueAsDate = new Date();
            document.getElementById('tradeForm').addEventListener('submit', addTrade);
            document.getElementById('filterType').addEventListener('change', (e) => {
                renderTrades(e.target.value);
            });
        });
    </script>
</body>
</html>